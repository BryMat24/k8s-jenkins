apiVersion: v1
kind: Pod
metadata:
  name: jenkins-agent
spec:
  containers:
    - name: jnlp
      image: brymat24/jnlp-dind
      args: ['${computer.jnlpmac}', '${computer.name}']
      securityContext:
        privileged: true
      env:
        - name: DOCKER_HOST
          value: "tcp://localhost:2375"
        - name: "JENKINS_URL"
          value: "http://jenkins-operator-http-jenkins.jenkins.svc.cluster.local:8080/"
        - name: "JENKINS_TUNNEL"
          value: "jenkins-operator-slave-jenkins.jenkins.svc.cluster.local:50000"
    - name: docker
      image: docker:20.10.7-dind
      securityContext:
        privileged: true
      env:
        - name: DOCKER_TLS_CERTDIR
          value: ""
      command:
        - dockerd
      args:
        - --host=tcp://0.0.0.0:2375
        - --host=unix:///var/run/docker.sock
      volumeMounts:
        - name: docker-graph-storage
          mountPath: /var/lib/docker
  volumes:
    - name: docker-graph-storage
      emptyDir: {}